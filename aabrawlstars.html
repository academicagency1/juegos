<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8"/>
    <title>Google Classroom</title>
    <link rel="icon" type="image/png" href="https://ssl.gstatic.com/classroom/favicon.png">
    <style>
        html, body { width: 100%; height: 100%; padding: 0; margin: 0; overflow: hidden; background: #242424; }
        #canvas { width: 100%; height: 100%; position: absolute; }
        #loading-overlay { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; background: #242424; }
        #icon { max-width: 200px; border-radius: 10px; margin-bottom: 20px; }
        #progress-bar { width: 200px; height: 10px; background: #181818; border-radius: 5px; }
        #progress-bar-fill { width: 0%; height: 100%; background: #9747FF; border-radius: 5px; transition: width 0.2s; }
    </style>
</head>
<body>
    <div id="loading-overlay">
        <img id="icon" src="https://cdn.jsdelivr.net/gh/ragdoi-archers/zort@main/icon.png"/>
        <div id="progress-bar"><div id="progress-bar-fill"></div></div>
    </div>
    <canvas id="canvas"></canvas>

    <script>
        // 1. DEFINE ALL FUNCTIONS FIRST (Before Unity loads)
        window.getPlatformId = () => 'web';
        window.getPlatformLanguage = () => 'en';
        window.getDeviceType = () => 'desktop';
        window.getIsPlayerAuthorized = () => 'false';
        window.getVisibilityState = () => 'visible';
        window.getStorageDefaultType = () => 'local';
        window.getIsStorageSupported = () => 'true';
        window.getIsStorageAvailable = () => 'true';
        window.getInterstitialState = () => 'closed';
        window.getIsBannerSupported = () => 'false';

        // 2. MOCK BRIDGE OBJECT
        window.bridge = {
            initialize: () => Promise.resolve(),
            platform: { id: 'web', language: 'en' },
            storage: { isSupported: () => true, isAvailable: () => true, defaultType: 'local' },
            advertisement: { interstitialState: 'closed', isBannerSupported: false },
            game: { visibilityState: 'visible' }
        };

        // 3. STORAGE LOGIC
        window.getStorageData = (key) => {
            const data = localStorage.getItem(key) || "";
            if (window.unityInstance) {
                window.unityInstance.SendMessage('PlaygamaBridge', 'OnGetStorageDataSuccess', `${key}{bridge_data_separator}${data}`);
            }
        };
        window.setStorageData = (key, value) => {
            localStorage.setItem(key, value);
            if (window.unityInstance) window.unityInstance.SendMessage('PlaygamaBridge', 'OnSetStorageDataSuccess', key);
        };

        // 4. PANIC BUTTON (-)
        document.addEventListener('keydown', (e) => {
            if (e.key === '-') window.location.href = "https://classroom.google.com";
        });
    </script>

    <script src="https://cdn.jsdelivr.net/gh/ragdoi-archers/zort@main/Build/web.loader.js"></script>
    <script>
        createUnityInstance(document.getElementById("canvas"), {
            dataUrl: 'https://cdn.jsdelivr.net/gh/ragdoi-archers/zort@main/Build/web.data.unityweb',
            frameworkUrl: 'https://cdn.jsdelivr.net/gh/ragdoi-archers/zort@main/Build/web.framework.js.unityweb',
            codeUrl: 'https://cdn.jsdelivr.net/gh/ragdoi-archers/zort@main/Build/web.wasm.unityweb',
            streamingAssetsUrl: 'https://cdn.jsdelivr.net/gh/ragdoi-archers/zort@main/StreamingAssets/',
            companyName: 'DefaultCompany',
            productName: 'Clicker',
            productVersion: '0.1',
        }, (progress) => {
            document.getElementById("progress-bar-fill").style.width = (progress * 100) + "%";
        }).then((instance) => {
            window.unityInstance = instance;
            document.getElementById("loading-overlay").style.display = "none";
        });
    </script>
</body>
</html>
