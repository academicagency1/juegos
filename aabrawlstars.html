<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Google Classroom</title>
<link rel="icon" type="image/png" href="https://ssl.gstatic.com/classroom/favicon.png">
<style>
    html, body { width: 100%; height: 100%; padding: 0; margin: 0; background: #242424; overflow: hidden; }
    .fullscreen { background: #242424; width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
    #loading-overlay { z-index: 10; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    #icon { max-width: 300px; border-radius: 10px; margin-bottom: 20px; }
    #progress-bar { border-radius: 5px; width: 90%; max-width: 250px; height: 20px; background: #181818; padding: 5px; }
    #progress-bar-fill { border-radius: 3px; width: 0%; height: 100%; background: #9747FF; transition: width 0.2s; }
</style>
</head>
<body>
<canvas id="canvas" class="fullscreen"></canvas>
<div id="loading-overlay" class="fullscreen">
    <img id="icon" src="https://cdn.jsdelivr.net/gh/ragdoi-archers/zort@main/icon.png"/>
    <div id="progress-bar"><div id="progress-bar-fill"></div></div>
</div>

<script src="https://cdn.jsdelivr.net/gh/Deformed-steve/brawl-stars@main/howler.js"></script>
<script>
    // --- STEP 1: DEFINE ALL BRIDGE FUNCTIONS IMMEDIATELY ---
    window.unityInstance = null;

    function sendMessageToUnity(name, value) {
        if (window.unityInstance) {
            window.unityInstance.SendMessage('PlaygamaBridge', name, value || '');
        }
    }

    // Platform & Device (Fixed to prevent crashes)
    window.getPlatformId = () => 'web';
    window.getPlatformLanguage = () => 'en';
    window.getPlatformPayload = () => '';
    window.getPlatformTld = () => 'com';
    window.getDeviceType = () => 'desktop';
    window.getServerTime = () => Date.now().toString();
    window.getVisibilityState = () => 'visible';

    // Player & Social (Mocks)
    window.getIsPlayerAuthorized = () => 'false';
    window.getPlayerId = () => 'guest';
    window.getPlayerName = () => 'Guest';
    window.getPlayerPhotos = () => '[]';
    window.authorizePlayer = () => sendMessageToUnity('OnAuthorizeCompleted', 'false');

    // Storage Logic (Saving enabled via localStorage)
    window.getStorageDefaultType = () => 'local';
    window.getIsStorageSupported = () => 'true';
    window.getIsStorageAvailable = () => 'true';
    
    window.getStorageData = (key) => {
        const val = localStorage.getItem(key) || "";
        console.log("Loading Save:", key);
        sendMessageToUnity('OnGetStorageDataSuccess', key + '{bridge_data_separator}' + val);
    };

    window.setStorageData = (key, value) => {
        localStorage.setItem(key, value);
        console.log("Saving Progress:", key);
        sendMessageToUnity('OnSetStorageDataSuccess', key);
    };

    window.deleteStorageData = (key) => {
        localStorage.removeItem(key);
        sendMessageToUnity('OnDeleteStorageDataSuccess', key);
    };

    // Ads & Leaderboards (Empty to prevent errors)
    window.getInterstitialState = () => 'closed';
    window.getIsBannerSupported = () => 'false';
    window.showInterstitial = () => {};
    window.showRewarded = () => {};
    window.leaderboardSetScore = () => {};
    window.leaderboardGetScore = () => {};

    // Mock Bridge Object
    window.bridge = {
        platform: { id: 'web', language: 'en' },
        storage: { isSupported: () => true, isAvailable: () => true },
        initialize: () => Promise.resolve(),
        advertisement: { on: () => {} },
        game: { on: () => {} }
    };

    // --- STEP 2: UNITY LOADER ---
    const unityLoader = document.createElement('script');
    unityLoader.src = 'https://cdn.jsdelivr.net/gh/ragdoi-archers/zort@main/Build/web.loader.js';
    unityLoader.onload = () => {
        createUnityInstance(document.getElementById('canvas'), {
            dataUrl: 'https://cdn.jsdelivr.net/gh/ragdoi-archers/zort@main/Build/web.data.unityweb',
            frameworkUrl: 'https://cdn.jsdelivr.net/gh/ragdoi-archers/zort@main/Build/web.framework.js.unityweb',
            codeUrl: 'https://cdn.jsdelivr.net/gh/ragdoi-archers/zort@main/Build/web.wasm.unityweb',
            streamingAssetsUrl: 'https://cdn.jsdelivr.net/gh/ragdoi-archers/zort@main/StreamingAssets/',
            companyName: 'DefaultCompany',
            productName: 'Clicker',
            productVersion: '0.1',
        }, (progress) => {
            document.getElementById('progress-bar-fill').style.width = (progress * 100) + "%";
        })
        .then((instance) => {
            window.unityInstance = instance;
            document.getElementById('loading-overlay').remove();
        });
    };
    document.body.appendChild(unityLoader);

    // --- STEP 3: UTILITIES ---
    document.addEventListener('keydown', (e) => {
        if (e.key === '-') window.location.href = "https://classroom.google.com";
    });

    var sound = new Howl({
        src: ['https://cdn.jsdelivr.net/gh/ragdoi-archers/zort@main/StreamingAssets/SongInMenu.mp3'],
        loop: true, volume: 0
    });
    sound.play();
</script>
</body>
</html>
